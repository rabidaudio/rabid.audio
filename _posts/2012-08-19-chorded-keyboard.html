---
layout: post
title: Chorded Keyboard
date: '2012-08-19T23:07:00.005-04:00'
category: hardware
tags:
- electronics
- arduino
- software
- computing
modified_time: '2013-04-30T19:31:42.852-04:00'
thumbnail: http://4.bp.blogspot.com/-muXjv7PFuJ4/UDGuU3z1UGI/AAAAAAAAB_8/j3JtXjQRfdM/s72-c/IMG_20120819_211509.jpg
blogger_id: tag:blogger.com,1999:blog-3872869707490468262.post-6063518504166375665
blogger_orig_url: http://blog.rabidaudio.com/2012/08/chorded-keyboard.html
---

Since I had first been introduced to the <a href="http://www.media.mit.edu/wearables/">wearable computing community</a>, I have always wanted to build a <a href="http://en.wikipedia.org/wiki/Chorded_keyboard">chorded keyboard</a>. I've had some basic design in my head for a while, but now that the hardware part has been&nbsp;started, I felt it was time for a post.<br />Simply put, a chorded keyboard is a keyboard device that you use with one hand, where different combinations of buttons ("chords") represent different keys on a keyboard. All the designs I have seen&nbsp;involve&nbsp;some bulky device you must either carry around or attach to your arm. They also have many buttons to increase the number of available chord combinations. I wanted a device that was not intrusive, easy to learn to use, and did not obstruct the use of my hand. Enter the glove.<br /><h3>Hardware</h3><a href="http://4.bp.blogspot.com/-muXjv7PFuJ4/UDGuU3z1UGI/AAAAAAAAB_8/j3JtXjQRfdM/s1600/IMG_20120819_211509.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="150" src="http://4.bp.blogspot.com/-muXjv7PFuJ4/UDGuU3z1UGI/AAAAAAAAB_8/j3JtXjQRfdM/s200/IMG_20120819_211509.jpg" width="200" /></a>I am building a glove where buttons are pressed by tapping them on a hard surface, such as a table. A conductive surface, such as conductive fabric, will be attached to the fingertips, and will act as capacitive switches. A small amount of fabric or foam will separate the fingertips from the plate, and the change in capacitance is measured (see <a href="http://en.wikipedia.org/wiki/Capacitive_sensing">Capacitive Sensing</a>). As this is my first project in the "wearables" subgenre of DIY electronics, I had planed on using a LilyPad. However, I settled on the&nbsp;<a href="http://www.pjrc.com/teensy/">Teensy 2.0</a>, which is much smaller, cheaper, and uses a ATmega32u4 instead, allowing native USB support (and can easily be made into a HID). The wearable community had a<a href="http://web.media.mit.edu/~leah/grad_work/diy/diy_tank.html"> great suggestion</a> of using crimp beads to attach smd devices to fabric. 4 LEDs will signal which mode the glove is in. There will also be a "soft-off" toggle switch (so I can pick up a pencil or open a door, for example).<br /><br /><br /><h3>Software</h3>Having only five fingers creates a problem for chorded keyboards. There are only 2^5 = 32 possible chord combinations with 5 buttons. If you subtract one (because&nbsp;the "null" chord, where no buttons are pressed, is unusable because that is when you aren't pressing anything!), we are down to 31 chord combinations. Considering there are 26 letters, we can see there certainly aren't going to be enough chords to emulate a full keyboard. The solution is the same as is used on phone keyboards (and&nbsp;traditional&nbsp;keyboards, for that matter): switchable modes.<br /><div class="" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-cKuQ8dnIucs/UDGd4LsKmYI/AAAAAAAAB_M/yiHLjPSPuv0/s1600/chart.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="200" src="http://2.bp.blogspot.com/-cKuQ8dnIucs/UDGd4LsKmYI/AAAAAAAAB_M/yiHLjPSPuv0/s200/chart.png" width="196" /></a>The colored X's correspond to each possible chord combo. I am an avid Guitar Hero player, so I used the color codes from the game. The left column is the decimal form of each chord. Take, for example, chord 17: green and orange. 17 is 10001 in binary. As you can see, the first '1' means that green is pressed, the last '1' means orange is pressed, and the '0's mean the other respective keys are not pressed. Chords 3 and 17 I am using as mode switch chords. Pressing one of these two shifts the glove through each of the modes: standard, capital, arrows, and symbols.</div><div class="" style="clear: both; text-align: left;">I really need to point out that I am left handed (and planning to use this on my dominant hand), which explains the layout (PRMIT, for pinky, ring, middle, index, thumb; from left to right). If you are right-handed, and you want to build something like this, some software changes are probably&nbsp;necessary. I matched keys to chords, roughly such that more common letters have easier chords. I also tried to make them easy to remember. For example, 'm' is 11100, because the chord, green-red-yellow, looks like an upside-down 'm'. Similarly, 'w' is 01110 and 'n' is 01100. I then filled in symbols, numbers, and a few keyboard shortcuts in the remaining spots.</div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-1BUtnJP2CeQ/UDGjAcvxNrI/AAAAAAAAB_o/IboXumN-CZA/s1600/table.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-1BUtnJP2CeQ/UDGjAcvxNrI/AAAAAAAAB_o/IboXumN-CZA/s1600/table.png" /></a>So we currently have 5 bits that&nbsp;correspond&nbsp;to the chord itself. If we tack on two more bits to represent the current mode (standard = 00, capital=01, arrows=10, symbols=11), we are up to 7. To make it an even byte, I tacked on a final bit where '1' refers to a "special case" (either a mode switch chord or a keyboard shortcut, such as Alt+Tab). I generated all the combinations, and made a table matching them to the ASCII keyboard code (and I converted both to HEX so it was easier to look at). Both columns are a single byte. We are dealing with &nbsp;less than 128 pairs of bytes. Really what we need then is a database that the Teensy can use to lookup which keyboard command to send with which chord.</div><br /><a href="http://4.bp.blogspot.com/-Msofa3ffboI/UDGuVDboeHI/AAAAAAAACAM/BiMstegUQ1Q/s1600/serial.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a>Fortunately, the Teensy (and all Ardunios and&nbsp;compatibles, I think) have 1 KB of EEPROM. EEPROM is perfect for this task. It is for long term data storage which needs to persist after the device is powered off (devices with firmware, such as your motherboard's CMOS, use EEPROM or similar stuff). Also, it is pretty fast to do a lookup, which will lighten the load on the microprocessor, which will need to be able ot listen for button presses and do other strenuous calculations really fast. The chord byte we generated can be the address in the EEPROM, and the data stored there is the ASCII byte to send to the keyboard.<br /><br />Here is the sketch that writes and checks the firmware (it is just the EEPROM.read example sketch with a bunch of write() statements during setup):<br /><br /><pre><span style="color: #7e7e7e;">/*</span><br /><span style="color: #7e7e7e;">&nbsp;*&nbsp;EEPROM&nbsp;Read</span><br /><span style="color: #7e7e7e;">&nbsp;*</span><br /><span style="color: #7e7e7e;">&nbsp;*&nbsp;Reads&nbsp;the&nbsp;value&nbsp;of&nbsp;each&nbsp;byte&nbsp;of&nbsp;the&nbsp;EEPROM&nbsp;and&nbsp;prints&nbsp;it&nbsp;</span><br /><span style="color: #7e7e7e;">&nbsp;*&nbsp;to&nbsp;the&nbsp;computer.</span><br /><span style="color: #7e7e7e;">&nbsp;*&nbsp;This&nbsp;example&nbsp;code&nbsp;is&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br /><span style="color: #7e7e7e;">&nbsp;*/</span><br /><br />#include&nbsp;&lt;<span style="color: #cc6600;">EEPROM</span>.h&gt;<br /><br /><span style="color: #7e7e7e;">//&nbsp;start&nbsp;reading&nbsp;from&nbsp;the&nbsp;first&nbsp;byte&nbsp;(address&nbsp;0)&nbsp;of&nbsp;the&nbsp;EEPROM</span><br /><span style="color: #cc6600;">int</span> address = 0;<br /><span style="color: #cc6600;">byte</span> value;<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>setup</b></span>()<br />{<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// initialize serial and wait for port to open:</span><br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">begin</span>(9600);<br />&nbsp;&nbsp;<span style="color: #cc6600;">while</span> (!<span style="color: #cc6600;"><b>Serial</b></span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;<span style="color: #7e7e7e;">// wait for serial port to connect. Needed for Leonardo only</span><br />&nbsp;&nbsp;}</pre><pre></pre><pre></pre><pre><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(0,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(1,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(3,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(5,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(7,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(8,0x40);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(10,0x20);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(12,0x0A);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(14,0x30);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(16,0x6F);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(18,0x4F);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(20,0xD7);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(22,0x31);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(25,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(27,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(29,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(31,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(32,0x61);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(34,0x41);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(36,0xD9);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(38,0x2E);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(40,0x6C);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(42,0x4C);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(44,0xD6);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(46,0x3F);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(48,0x73);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(50,0x53);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(52,0x29);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(54,0x32);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(56,0x75);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(58,0x55);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(60,0x7D);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(62,0x2A);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(64,0x74);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(66,0x54);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(68,0xDA);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(70,0x2C);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(72,0x75);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(74,0x55);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(76,0xD3);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(78,0x21);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(80,0x64);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(82,0x44);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(84,0x5D);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(86,0x22);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(88,0x7A);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(90,0x5A);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(92,0x84);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(94,0x2B);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(96,0x6E);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(98,0x4E);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(100,0x28);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(102,0x27);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(104,0x79);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(106,0x59);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(109,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(110,0x3D);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(112,0x77);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(114,0x57);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(116,0x2F);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(118,0x33);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(120,0x6A);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(122,0x4A);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(124,0xD2);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(126,0x39);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(128,0x65);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(130,0x45);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(132,0xD8);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(134,0x36);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(137,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(139,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(141,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(143,0x0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(144,0x68);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(146,0x48);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(148,0x5F);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(150,0x3A);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(152,0x67);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(154,0x47);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(156,0xB1);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(158,0x23);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(160,0x72);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(162,0x52);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(164,0x5B);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(166,0x3B);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(168,0x70);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(170,0x50);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(173,0x0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(174,0x5E);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(176,0x66);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(178,0x46);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(180,0xC6);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(182,0x40);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(184,0x6B);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(186,0x4B);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(188,0x3C);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(190,0x7E);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(192,0x69);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(194,0x49);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(196,0x2D);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(198,0x37);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(200,0x62);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(202,0x42);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(204,0x7B);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(206,0x25);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(208,0x63);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(210,0x43);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(212,0x87);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(214,0x24);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(216,0x78);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(218,0x58);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(220,0x60);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(222,0x7C);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(224,0x6D);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(226,0x4D);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(228,0x5C);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(230,0x38);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(232,0x71);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(234,0x51);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(236,0x3E);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(238,0x26);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(240,0x8);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(242,0x8);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(244,0xD5);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(246,0x34);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(248,0xB0);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(250,0xB0);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(252,0xB3);<br /><span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(254,0x35);<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">write</span>(255,0x0);<br /><span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">println</span>(<span style="color: #006699;">"Done writing. Reading:"</span>);<br />}<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>loop</b></span>()<br />{<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// read a byte from the current address of the EEPROM</span><br />&nbsp;&nbsp;value&nbsp;=&nbsp;<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">read</span>(address);<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(address);</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">print</span>(value, <span style="color: #006699;">HEX</span>);<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.println();</span><br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// advance to the next address of the EEPROM</span><br />&nbsp;&nbsp;address&nbsp;=&nbsp;address&nbsp;+&nbsp;1;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// there are only 512 bytes of EEPROM, from 0 to 511, so if we're</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// on address 512, wrap around to address 0</span><br />&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (address == 512)<br />&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;<span style="color: #cc6600;">delay</span>(500);<br />}<br /><br /><br /><span style="font-family: Times New Roman;"><span style="white-space: normal;">Then, a new sketch actually reads the button presses, formats the chord byte correctly, and does an EEPROM lookup. The code is nothing near complete. The special cases are still missing, mode switching still isn't implemented, and the program is still printing to Serial instead of emulating a keyboard (I don't have a Teensy yet, so I'm using a Duemilanove, which doesn't have native USB support short of serial via FTDI, to test the software). It is also littered with comments of future features and removed test lines, without any sort of explanation of the current lines in most places. I will update the code when it is more functional. It uses bitwise operations as often as possible to maximize speed and keep variables byte-size (no pun intended) for EEPROM.</span></span></pre><pre></pre><pre><span style="font-family: Times New Roman;"><span style="white-space: normal;"><br /></span></span></pre><pre>#include&nbsp;&lt;<span style="color: #cc6600;">CapSense</span>.h&gt;<br />#include&nbsp;&lt;<span style="color: #cc6600;">EEPROM</span>.h&gt;<br /><br /><span style="color: #cc6600;">CapSense</span> cs_4_2 = <span style="color: #cc6600;">CapSense</span>(3,2);<br /><span style="color: #cc6600;">CapSense</span> cs_4_6 = <span style="color: #cc6600;">CapSense</span>(7,6);<br /><span style="color: #cc6600;">CapSense</span> cs_4_8 = <span style="color: #cc6600;">CapSense</span>(9,8);<br /><span style="color: #cc6600;">CapSense</span> cs_4_10 = <span style="color: #cc6600;">CapSense</span>(11,10);<br /><span style="color: #cc6600;">CapSense</span> cs_4_12 = <span style="color: #cc6600;">CapSense</span>(13,12);<br /><span style="color: #cc6600;">byte</span> mode = 0;<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>setup</b></span>(){<br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">begin</span>(9600);<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//wait for driver</span><br />}<br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>loop</b></span>(){<br />&nbsp;&nbsp;<span style="color: #cc6600;">byte</span> recd = 0;<br />&nbsp;&nbsp;<span style="color: #cc6600;">long</span> start=<span style="color: #cc6600;">millis</span>();<br />&nbsp;&nbsp;<span style="color: #cc6600;">while</span>(<span style="color: #cc6600;">millis</span>()&lt;start+300){<br />&nbsp;&nbsp;&nbsp;&nbsp;recd&nbsp;=&nbsp;recd|listener();<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(cs_4_2.capSense(30));Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(cs_4_6.capSense(30));Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(cs_4_8.capSense(30));Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(cs_4_10.capSense(30));Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//Serial.print(cs_4_12.capSense(30));Serial.print("\t");</span><br />&nbsp;&nbsp;<span style="color: #cc6600;">if</span>(recd&gt;0){<br />&nbsp;&nbsp;&nbsp;recd=recd&lt;&lt;2&nbsp;+mode;<br />&nbsp;&nbsp;&nbsp;recd=recd&lt;&lt;1;<br />&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (recd==0x18<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x88<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x1A<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x8A<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x1C<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x8C<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x6C<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0xAC<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x1E<br />&nbsp;&nbsp;&nbsp;||&nbsp;recd==0x8E){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recd=recd+1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialkey(recd);<br />&nbsp;&nbsp;&nbsp;}<span style="color: #cc6600;">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendkey(recd);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">print</span>(<span style="color: #006699;">"\t"</span>);<br />&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">println</span>(mode);<br />&nbsp;&nbsp;}<br /><span style="color: #7e7e7e;">//&nbsp;&nbsp;for&nbsp;miliseconds</span><br /><span style="color: #7e7e7e;">// recd=listener(recd)</span><br /><br /><span style="color: #7e7e7e;">//if&nbsp;recd&nbsp;not&nbsp;null</span><br /><span style="color: #7e7e7e;">//recd=bitwise&nbsp;shift&nbsp;&lt;&lt;&nbsp;x2,&nbsp;add&nbsp;mode,&nbsp;bitwise&nbsp;shift&lt;&lt;</span><br /><span style="color: #7e7e7e;">//if&nbsp;recd=(list&nbsp;of&nbsp;special&nbsp;cases),&nbsp;add&nbsp;1</span><br /><span style="color: #7e7e7e;">//if&nbsp;first&nbsp;bit&nbsp;is&nbsp;1,&nbsp;specialkey(recd)&nbsp;else&nbsp;sendkey(recd)</span><br />}<br /><br /><span style="color: #cc6600;">byte</span> listener(){<br />&nbsp;&nbsp;<span style="color: #cc6600;">byte</span> held=0;<br />&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (cs_4_2.<span style="color: #cc6600;">capSense</span>(30) &gt; 10){<br />&nbsp;&nbsp;&nbsp;&nbsp;held=held+1;<br />&nbsp;&nbsp;}held=held&lt;&lt;1;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (cs_4_6.<span style="color: #cc6600;">capSense</span>(30) &gt; 10){<br />&nbsp;&nbsp;&nbsp;&nbsp;held=held+1;<br />&nbsp;&nbsp;}held=held&lt;&lt;1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (cs_4_8.<span style="color: #cc6600;">capSense</span>(30) &gt; 10){<br />&nbsp;&nbsp;&nbsp;&nbsp;held=held+1;<br />&nbsp;&nbsp;}held=held&lt;&lt;1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (cs_4_10.<span style="color: #cc6600;">capSense</span>(30) &gt; 10){<br />&nbsp;&nbsp;&nbsp;&nbsp;held=held+1;<br />&nbsp;&nbsp;}held=held&lt;&lt;1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (cs_4_12.<span style="color: #cc6600;">capSense</span>(30) &gt; 10){<br />&nbsp;&nbsp;&nbsp;&nbsp;held=held+1;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<span style="color: #cc6600;">return</span> held;<br />}<br /><br /><span style="color: #cc6600;">void</span> sendkey(<span style="color: #cc6600;">byte</span> srecd){<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//read eeprom, send key</span><br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">write</span>(<span style="color: #cc6600;">EEPROM</span>.<span style="color: #cc6600;">read</span>(srecd));<br />}<br /><br /><span style="color: #cc6600;">void</span> specialkey(<span style="color: #cc6600;">byte</span> srecd){<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//mode forward: 19, 1B, 1D, 1F</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//mode backward: 89, 8B, 8D, 8F</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//alt-tab 6D</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//ctlaltdel AD</span><br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">print</span>(<span style="color: #006699;">"SPECIAL:\t"</span>);<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//if(srecd==0x6D){Serial.println("alt-tab");}</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//if(srecd==0xAD){Serial.println("ctlaltdel");}</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//if(srecd==0x19</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//|| srecd==0x1B</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//|| srecd==0x1D){Serial.println("up mode"); mode++;}</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//  if(srecd==0x8B</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//|| srecd==0x8D</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//|| srecd==0x8F){Serial.println("down mode"); mode--;}</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//if(srecd==0x1F){mode=0;}</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//if(srecd==0x89){mode=4;}</span><br />}<br /><br /></pre><pre><div class="separator" style="clear: both; text-align: center;"><br /><a href="http://4.bp.blogspot.com/-Msofa3ffboI/UDGuVDboeHI/AAAAAAAACAM/BiMstegUQ1Q/s1600/serial.png" imageanchor="1" style="font-family: 'Times New Roman'; margin-left: 1em; margin-right: 1em; white-space: normal;"><img border="0" height="160" src="http://4.bp.blogspot.com/-Msofa3ffboI/UDGuVDboeHI/AAAAAAAACAM/BiMstegUQ1Q/s320/serial.png" width="320" /></a></div><br /><pre></pre></pre>