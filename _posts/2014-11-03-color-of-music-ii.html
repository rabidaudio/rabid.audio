---
layout: post
title: Color of Music II
date: '2014-11-03T01:17:00.000-05:00'
author: Charles Knight
tags:
- software
- music
- dsp
- computing
modified_time: '2014-11-03T01:22:31.020-05:00'
thumbnail: http://1.bp.blogspot.com/-lsm11OylLtU/VFcb31KoB8I/AAAAAAAAKC0/KT56vUJcQAQ/s72-c/handel-color.png
blogger_id: tag:blogger.com,1999:blog-3872869707490468262.post-2154991219583803709
blogger_orig_url: http://blog.rabidaudio.com/2014/11/color-of-music-ii.html
---

<div class="separator" style="clear: both; text-align: center;"></div><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;">I long time ago (ages it seems), I <a href="{{ site.baseurl }}{% post_url 2012-11-28-the-color-of-music %}">posted about mapping the audio spectrum to the visual spectrum</a> after watching <a href="http://ideas.ted.com/2013/07/11/the-sound-of-color-neil-harbissons-talk-visualized/">Neil Harbisson's TED talk</a>. Well <a href="http://www.npr.org/programs/ted-radio-hour/?showDate=2014-10-31">NPR mentioned that same talk today</a> and it got me excited about the project again. I played around some more using my slightly more developed MATLAB and DSP skills, and the results are below.</span></span></span><br /><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;"><br /></span></span></span><br /><h4><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;">Quick recap:</span></span></span></h4><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;">Sound and light are both waves though they differ significantly in frequency, medium,&nbsp;propagation&nbsp;type, and speed. A major similarity though is that we have sensory organs for both, and those sensory organs have some interesting quirks. Humans can only perceive small bands of each spectrum. The audio band is typically quoted at 20Hz to 20KHz (point of reference: the A below middle C on a piano is 440Hz). The visible light spectrum goes from roughly 700 nm where infrared transitions to red, to about 400 nm where violet transitions into ultraviolet (it's easier to talk about light in wavelengths=speed of light/frequency&nbsp;because the frequencies are huge numbers). The exact endpoints of these bands vary from person to person, and often with age; however, the range for an average human is well known.</span></span></span><br /><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;"><br /></span></span></span><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;">Another quirk of human perception is that we don't perceive equally across these bands. I know a lot more about these limitations in the audio world than in the video world, but </span><a href="http://en.wikipedia.org/wiki/Color_vision#Physiology_of_color_perception" style="line-height: 25px;" target="_blank">there is plenty to read on that if you're interested</a><span style="line-height: 25px;">. We perceive sound on a logarithmic scale, both in loudness and pitch. The decibel scale adjusts for this, so that a 20dB noise sounds twice as loud as a 10dB sound, even though the former is actually about 2.8 times the pressure. And a 40dB sound again sounds twice as loud as that, but is actually 10 times the pressure of 20dB and 28 times the pressure of 10dB. Not only this, but we don't perceive loudness evenly over all frequencies.&nbsp;</span></span></span><br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://upload.wikimedia.org/wikipedia/commons/4/47/Lindos1.svg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><span style="font-family: inherit;"><img border="0" src="http://upload.wikimedia.org/wikipedia/commons/4/47/Lindos1.svg" height="287" width="320" /></span></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><a href="http://en.wikipedia.org/wiki/Equal-loudness_contour" target="_blank"><span style="font-family: inherit;">Wikipedia</span></a></td></tr></tbody></table><span style="color: #333333; font-family: inherit;"><span style="background-color: white;"><span style="line-height: 25px;"><br /></span></span></span><span style="color: #333333; font-family: inherit;"><span style="background-color: white; line-height: 25px;">Lower frequencies sound much quieter than middle and high frequencies, and the function is not an elegant relation. Psychologists studied people's perceived loudness and created the <a href="http://en.wikipedia.org/wiki/Equal-loudness_contour" target="_blank">equal-loudness contours</a>. Along the red lines are sounds at a constant "perceived loudness" (measured in phons, a made-up unit which sets it's point of reference so that 20dB of pressure equals 20 phons). For different frequencies, different amounts of pressure are required to reach that phon level. There are a number of <a href="http://en.wikipedia.org/wiki/A-weighting" target="_blank">functions which approximate the correction factor</a>, such as the <a href="http://en.wikipedia.org/wiki/A-weighting#A" target="_blank">A-weighting filter</a>.</span></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://upload.wikimedia.org/math/6/e/b/6ebb25bed262481926f846cc628aaa7a.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://upload.wikimedia.org/math/6/e/b/6ebb25bed262481926f846cc628aaa7a.png" height="38" width="400" /></span></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://upload.wikimedia.org/math/7/4/7/747b7290d73cf4a62227627c32da184e.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://upload.wikimedia.org/math/7/4/7/747b7290d73cf4a62227627c32da184e.png" height="16" width="200" /></span></a></div><span style="color: #333333; font-family: inherit;"><span style="background-color: white; line-height: 25px;"><br /></span></span><span style="font-family: inherit;"><br /></span><br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="clear: left; float: left; margin-bottom: 1em; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://upload.wikimedia.org/wikipedia/commons/a/aa/Mel-Hz_plot.svg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><span style="font-family: inherit;"><img border="0" src="http://upload.wikimedia.org/wikipedia/commons/a/aa/Mel-Hz_plot.svg" height="151" width="320" /></span></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><a href="http://en.wikipedia.org/wiki/Mel_scale" target="_blank"><span style="font-family: inherit;">Wikipedia</span></a></td></tr></tbody></table><span style="font-family: inherit;">Pitch perception is logarithmic also. Similar to the ELCs, psychologists created a unit for perceived pitch, the <a href="http://en.wikipedia.org/wiki/Mel_scale" target="_blank">mel</a> (where 1000 mel = 1KHz). A pitch that sounds about twice as high (2000 mel) is about 3.5KHz. The equation is below.</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://upload.wikimedia.org/math/d/0/e/d0eca36a98e851a9df82d4cc5e5d955f.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://upload.wikimedia.org/math/d/0/e/d0eca36a98e851a9df82d4cc5e5d955f.png" /></span></a></div><h4 style="clear: both; text-align: left;"><span style="font-family: inherit;">Results</span></h4><div><span style="font-family: inherit;">The goal then is to have something that hears a pitch, corrects for proper human perception of that pitch, and then maps that frequency's relative position in the audio band to a color in the same relative position in the visual band. Low frequency sounds would map to red and high frequencies to violet. I want the colors to map to the red-green-blue color space, so that they can be represented by a computer (e.g. an LCD display, a 3-color LED, etc.). Of course, there are all sorts of issues with a computer's ability to generate actual colors, which I touched on in my <a href="{{ site.baseurl }}{% post_url 2012-11-28-the-color-of-music %}" target="_blank">earlier post about this</a>. However, there are rough approximations that can map the color spectrum to RGB. <a href="http://stackoverflow.com/a/22681410" target="_blank">Here's the one I used from StackOverflow</a>&nbsp;(this guy has awesome graphs and seems to have done some impressive work):</span></div><div><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://i.stack.imgur.com/9YeIl.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://i.stack.imgur.com/9YeIl.png" height="180" width="400" /></span></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://i.stack.imgur.com/nWns3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://i.stack.imgur.com/nWns3.png" height="83" width="400" /></span></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;">The basic algorithm is to take a FFT of an audio sample at regular intervals to find the amplitude of different frequency components. Then those frequencies are converted to mels for the perceived log scale and then mels are mapped to light wavelengths. These wavelengths are then converted into RGB vectors using the algorithm above. The brightness of each channel is then weighted by both the phasor magnitude of the signal and the A-weighting loudness filter. This results in a final RGB vector for each small sample of audio where brightness is relative loudness and color is relative perceived pitch.</span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;">I ran this against MATLAB's sample file (a clip of Handel's Messiah). These are with an FFT sampling rate of 100Hz.</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-lsm11OylLtU/VFcb31KoB8I/AAAAAAAAKC0/KT56vUJcQAQ/s1600/handel-color.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://1.bp.blogspot.com/-lsm11OylLtU/VFcb31KoB8I/AAAAAAAAKC0/KT56vUJcQAQ/s1600/handel-color.png" height="153" width="400" /></span></a></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;">I then generated a video to go along with the audio. The first is the standard result, but it flickered unpleasantly, so the second is with a 10 frame (0.1 second) averaging filter applied. Forgive the low quality of each, generating MPEG4 video in MATLAB is not an easy task, and I ended up stringing together a bunch of JPEGs).</span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div style="text-align: center;"><span style="font-family: inherit;"><object width="320" height="266" class="BLOG_video_class" id="BLOG_video-5f68f113e9325d1e" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="movie" value="//www.youtube.com/get_player"><param name="bgcolor" value="#FFFFFF"><param name="allowfullscreen" value="true"><param name="flashvars" value="flvurl=http://redirector.googlevideo.com/videoplayback?id%3D5f68f113e9325d1e%26itag%3D5%26source%3Dblogger%26app%3Dblogger%26cmo%3Dsensitive_content%253Dyes%26ip%3D0.0.0.0%26ipbits%3D0%26expire%3D1420934338%26sparams%3Did,itag,source,ip,ipbits,expire%26signature%3D60BEEFD96B4EC1F2BBFFDC91BF73DED71B323596.338DB507087490199F6939959126B42C73E0685%26key%3Dck2&amp;iurl=http://video.google.com/ThumbnailServer2?app%3Dblogger%26contentid%3D5f68f113e9325d1e%26offsetms%3D5000%26itag%3Dw160%26sigh%3DA1PpitBBwGFu4lL3NCvQ31bCv_0&amp;autoplay=0&amp;ps=blogger"><embed src="//www.youtube.com/get_player" type="application/x-shockwave-flash" width="320" height="266" bgcolor="#FFFFFF" flashvars="flvurl=http://redirector.googlevideo.com/videoplayback?id%3D5f68f113e9325d1e%26itag%3D5%26source%3Dblogger%26app%3Dblogger%26cmo%3Dsensitive_content%253Dyes%26ip%3D0.0.0.0%26ipbits%3D0%26expire%3D1420934338%26sparams%3Did,itag,source,ip,ipbits,expire%26signature%3D60BEEFD96B4EC1F2BBFFDC91BF73DED71B323596.338DB507087490199F6939959126B42C73E0685%26key%3Dck2&iurl=http://video.google.com/ThumbnailServer2?app%3Dblogger%26contentid%3D5f68f113e9325d1e%26offsetms%3D5000%26itag%3Dw160%26sigh%3DA1PpitBBwGFu4lL3NCvQ31bCv_0&autoplay=0&ps=blogger" allowFullScreen="true" /></object></span></div><br /><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div style="text-align: center;"><span style="font-family: inherit;"><object width="320" height="266" class="BLOG_video_class" id="BLOG_video-62b807d25dc3d75f" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="movie" value="//www.youtube.com/get_player"><param name="bgcolor" value="#FFFFFF"><param name="allowfullscreen" value="true"><param name="flashvars" value="flvurl=http://redirector.googlevideo.com/videoplayback?id%3D62b807d25dc3d75f%26itag%3D5%26source%3Dblogger%26app%3Dblogger%26cmo%3Dsensitive_content%253Dyes%26ip%3D0.0.0.0%26ipbits%3D0%26expire%3D1420934338%26sparams%3Did,itag,source,ip,ipbits,expire%26signature%3DAF7229F09A8BC638DB18F73404BA98EAFFC3FDE.723FCA0D8B3994F430E1C9657DF7CF00807996C5%26key%3Dck2&amp;iurl=http://video.google.com/ThumbnailServer2?app%3Dblogger%26contentid%3D62b807d25dc3d75f%26offsetms%3D5000%26itag%3Dw160%26sigh%3DuQXbDgb1ObuD2GTcllcSJ0NXdNc&amp;autoplay=0&amp;ps=blogger"><embed src="//www.youtube.com/get_player" type="application/x-shockwave-flash" width="320" height="266" bgcolor="#FFFFFF" flashvars="flvurl=http://redirector.googlevideo.com/videoplayback?id%3D62b807d25dc3d75f%26itag%3D5%26source%3Dblogger%26app%3Dblogger%26cmo%3Dsensitive_content%253Dyes%26ip%3D0.0.0.0%26ipbits%3D0%26expire%3D1420934338%26sparams%3Did,itag,source,ip,ipbits,expire%26signature%3DAF7229F09A8BC638DB18F73404BA98EAFFC3FDE.723FCA0D8B3994F430E1C9657DF7CF00807996C5%26key%3Dck2&iurl=http://video.google.com/ThumbnailServer2?app%3Dblogger%26contentid%3D62b807d25dc3d75f%26offsetms%3D5000%26itag%3Dw160%26sigh%3DuQXbDgb1ObuD2GTcllcSJ0NXdNc&autoplay=0&ps=blogger" allowFullScreen="true" /></object></span></div><br /><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;">Unfortunately, it seems music is too low-bandwidth to see significant changes in pitch. One thing I might do in the future is map notes to colors, rather than the entire band.</span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: inherit;">Thoughts? Feel free to leave a comment. :)</span></div>